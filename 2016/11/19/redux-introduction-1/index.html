<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
    <meta name="description" content="Think less, do more.">
  

  
    <meta name="author" content="parryworld">
  

  
  <title>Redux 介绍（一）：基础教程 | Parryworld</title>

  <link rel="stylesheet" href="/blog/css/style.css">

  <link href='//fonts.googleapis.com/css?family=Bitter:400,700,400italic|Open+Sans:400italic,600italic,400,600' rel='stylesheet' type='text/css'>

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body>

    <section class="container">
  <header class="post-header">
    <h1>Redux 介绍（一）：基础教程</h1>
  </header>

  <article class="post-body">
    <p>Redux 是 JavaScript 上的可预测化的状态容器。</p>
<h2 id="为什么要使用-Redux-？"><a href="#为什么要使用-Redux-？" class="headerlink" title="为什么要使用 Redux ？"></a>为什么要使用 Redux ？</h2><p>我们知道，现在 JavaScript 单页应用开发日益复杂，页面里需要管理的 state 也越来越多。如果一个 model 的变化会引起另一个 model 的变化，那么当 model 的联系越来越多，越来越紧密之后，我们就很难有效地管理某个 model 或者 view 中的 state 了。在这种情况下，我们就需要用类似 Redux 的框架来统一管理应用中的状态。</p>
<h2 id="Redux-的基本思想"><a href="#Redux-的基本思想" class="headerlink" title="Redux 的基本思想"></a>Redux 的基本思想</h2><ol>
<li>最开始的问题在于，我们很难管理不同的 view 中的 state。因此，Redux 就把整个应用中的 state 储存在一棵 object tree 中，而且这个 object tree 只存在于唯一的 store 中。这样，我们就可以在最顶层预测所有的 state，并与 view 无关。</li>
<li>为了统一维护这棵状态树，Redux 通过触发 action 来改变 state，action 是一个用来描述某一动作的普通对象。</li>
<li>因为 action 是描述这一动作而不是修改 state， Redux 需要 reducer 来接收 action，然后根据 action 的内容来改变 state。</li>
</ol>
<p>这就是 Redux 的基本思想，其中只包括了三个简单概念：action, reducer, store。只要编写了这三个模块，就可以实现最基本的 Redux。</p>
<p>下面就以 todoApp 为例，实现 action, reducer, store 这三个模块。</p>
<h2 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h2><p>Action 用来告诉 store 发生了什么动作。下面是添加 todo 的 action ：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// app/actions/todo.js</span></div><div class="line"><span class="keyword">import</span> &#123; ADD_TODO &#125; <span class="keyword">from</span> <span class="string">'../constants/actionTypes'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addTodo</span>(<span class="params">text</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: ADD_TODO,</div><div class="line">    text</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Action 本质上是一个 JavaScript 对象，我们可以用函数封装好返回这个对象，方便移植。Action 必须包含一个 type 字段用来告诉 store 这是哪个动作。type 一般是字符串常量，当应用规模变大时，action 的数量也越来越多，可以把 type 储存在一个特定的文件里来维护，如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// app/constants/actionTypes.js</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> ADD_TODO = <span class="string">'ADD_TODO'</span>;</div></pre></td></tr></table></figure>
<p>通过 <code>dispatch(action)</code> 可以把 action 发送给 store。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dispatch(addTodo(text));</div></pre></td></tr></table></figure>
<p>在 store 中可以通过 <code>store.dispatch()</code> 调用 <code>dispatch()</code> 方法。但是在其他地方，一般使用 <code>react-redux</code> 提供的 <code>connect()</code> 来调用。</p>
<h2 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h2><p>现在我们通过 <code>dispatch(action)</code> 把 action 发送了出去。那么，可以编写 reducer 来接收这个 action 并改变 state。</p>
<p>Reducer 本质上就是一个纯函数，接收之前的 state 和 action，返回新的 state。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(previousState, action) =&gt; newState</div></pre></td></tr></table></figure></p>
<p>因为 reducer 会传递给 <code>Array.prototype.reduce(reducer, ?initialValue)</code>，所以一定要保持 reducer 的纯净，保证输入参数相同，返回的 state 也相同。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// app/reducers/todo.js</span></div><div class="line"><span class="keyword">import</span> &#123; ADD_TODO &#125; <span class="keyword">from</span> <span class="string">'../constants/actionTypes'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> initialState = &#123;</div><div class="line">  <span class="attr">todos</span>: []</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">todo</span>(<span class="params">state = initialState, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> ADD_TODO:</div><div class="line">      <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123;</div><div class="line">        <span class="attr">todos</span>: [</div><div class="line">          ...state.todos,</div><div class="line">          &#123;</div><div class="line">            <span class="attr">text</span>: action.text,</div><div class="line">            <span class="attr">completed</span>: <span class="literal">false</span></div><div class="line">          &#125;</div><div class="line">        ]</div><div class="line">      &#125;);</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> state;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>不要修改之前的 state，而是应该返回一个新的 state 副本。</li>
<li>一定要使用 <code>default</code> 来返回旧的 state。</li>
</ol>
<p>除了像上面一样使用 <code>Object.assign()</code> 来新建 state 副本，也可以使用 ES7 中的方法 <code>{ ...state, ...newState }</code> 来新建副本，如下所示：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> &#123;</div><div class="line">  ...state,</div><div class="line">  <span class="attr">todos</span>: [</div><div class="line">    ...state.todos,</div><div class="line">    &#123;</div><div class="line">      <span class="attr">text</span>: action.text,</div><div class="line">      <span class="attr">completed</span>: <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>这只是有关 todo 列表的 reducer，在整个应用中会有多个不同的 reducer 管理应用不同的部分，比如有关 setting 的 reducer 管理用户的设置等。每个 reducer 只负责管理 state tree 中的一部分。最后我们可以通过 <code>combineReducers()</code> 把所有的 reducer 合到一起。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// app/reducers/index.js</span></div><div class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">import</span> todo <span class="keyword">from</span> <span class="string">'./todo'</span>;</div><div class="line"><span class="keyword">import</span> reducer2 <span class="keyword">from</span> <span class="string">'./reducer2'</span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> rootReducer = combineReducers(&#123;</div><div class="line">  todo,</div><div class="line">  reducer2</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducer;</div></pre></td></tr></table></figure>
<h2 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h2><p>既然有了 reducer，我们就可以很容易地创建 store 了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// app/store/index.js</span></div><div class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">'../reducers'</span>;</div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = createStore(rootReducer);</div></pre></td></tr></table></figure>
<p>就是这么简单，现在我们可以发送 action 来添加 todo，并保存在 todos 的状态里。同样地，我们可以类似地编写更多的 action，创建更多的 state 来满足应用的需求。</p>
<h3 id="系列文章"><a href="#系列文章" class="headerlink" title="系列文章:"></a>系列文章:</h3><p><a href="http://parryworld.me/blog/2016/11/19/redux-introduction-2/">Redux 介绍（二）：异步 Thunk</a></p>
<p><a href="http://parryworld.me/blog/2016/11/20/redux-introduction-3/">Redux 介绍（三）：中间件 Middleware</a></p>

  </article>

  <footer class="post-footer">
  <div class="contact clearfix">
    <div class="social">
      <span>Contact me @ </span>
      <div class="icon-wrapper">
        <svg class="social-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M22,3H2A2,2,0,0,0,0,5V19a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V5A2,2,0,0,0,22,3ZM12,9.88,4.07,4H19.93ZM4,9.21l7.7,5.69a.5.5,0,0,0,.59,0L20,9.21V20H4Z" />
        </svg>
        <div class="icon-info">
          <p>parryworld@gmail.com</p>
        </div>
      </div>
      <a href="https://github.com/parryworld" target="_blank">
        <svg class="social-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
          <path d="M512 0C229.25 0 0 229.25 0 512c0 226.25 146.688 418.125 350.156 485.812 25.594 4.688 34.938-11.125 34.938-24.625 0-12.188-0.469-52.562-0.719-95.312C242 908.812 211.906 817.5 211.906 817.5c-23.312-59.125-56.844-74.875-56.844-74.875-46.531-31.75 3.53-31.125 3.53-31.125 51.406 3.562 78.47 52.75 78.47 52.75 45.688 78.25 119.875 55.625 149 42.5 4.654-33 17.904-55.625 32.5-68.375C304.906 725.438 185.344 681.5 185.344 485.312c0-55.938 19.969-101.562 52.656-137.406-5.219-13-22.844-65.094 5.062-135.562 0 0 42.938-13.75 140.812 52.5 40.812-11.406 84.594-17.031 128.125-17.219 43.5 0.188 87.312 5.875 128.188 17.281 97.688-66.312 140.688-52.5 140.688-52.5 28 70.531 10.375 122.562 5.125 135.5 32.812 35.844 52.625 81.469 52.625 137.406 0 196.688-119.75 240-233.812 252.688 18.438 15.875 34.75 47 34.75 94.75 0 68.438-0.688 123.625-0.688 140.5 0 13.625 9.312 29.562 35.25 24.562C877.438 930 1024 738.125 1024 512 1024 229.25 794.75 0 512 0z"/>
        </svg>
      </a>
      <a href="http://weibo.com/parryworld" target="_blank">
        <svg class="social-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
          <path d="M675 1284q21-34 11-69t-45-50q-34-14-73-1t-60 46q-22 34-13 68.5t43 50.5 74.5 2.5 62.5-47.5zm94-121q8-13 3.5-26.5t-17.5-18.5q-14-5-28.5.5t-21.5 18.5q-17 31 13 45 14 5 29-.5t22-18.5zm174 107q-45 102-158 150t-224 12q-107-34-147.5-126.5t6.5-187.5q47-93 151.5-139t210.5-19q111 29 158.5 119.5t2.5 190.5zm312-160q-9-96-89-170t-208.5-109-274.5-21q-223 23-369.5 141.5t-132.5 264.5q9 96 89 170t208.5 109 274.5 21q223-23 369.5-141.5t132.5-264.5zm308 4q0 68-37 139.5t-109 137-168.5 117.5-226 83-270.5 31-275-33.5-240.5-93-171.5-151-65-199.5q0-115 69.5-245t197.5-258q169-169 341.5-236t246.5 7q65 64 20 209-4 14-1 20t10 7 14.5-.5 13.5-3.5l6-2q139-59 246-59t153 61q45 63 0 178-2 13-4.5 20t4.5 12.5 12 7.5 17 6q57 18 103 47t80 81.5 34 116.5zm-74-624q42 47 54.5 108.5t-6.5 117.5q-8 23-29.5 34t-44.5 4q-23-8-34-29.5t-4-44.5q20-63-24-111t-107-35q-24 5-45-8t-25-37q-5-24 8-44.5t37-25.5q60-13 119 5.5t101 65.5zm181-163q87 96 112.5 222.5t-13.5 241.5q-9 27-34 40t-52 4-40-34-5-52q28-82 10-172t-80-158q-62-69-148-95.5t-173-8.5q-28 6-52-9.5t-30-43.5 9.5-51.5 43.5-29.5q123-26 244 11.5t208 134.5z"/>
        </svg>
      </a>
    </div>
  </div>
</footer>
</section>

</body>
</html>
